--- a/net/minecraft/server/commands/FillCommand.java
+++ b/net/minecraft/server/commands/FillCommand.java
@@ -7,6 +_,7 @@
 import com.mojang.brigadier.exceptions.CommandSyntaxException;
 import com.mojang.brigadier.exceptions.Dynamic2CommandExceptionType;
 import com.mojang.brigadier.exceptions.SimpleCommandExceptionType;
+import io.multipaper.shreddedpaper.ShreddedPaper;
 import java.util.Collections;
 import java.util.List;
 import java.util.function.Predicate;
@@ -188,6 +_,7 @@
             if (level.isDebug()) {
                 throw ERROR_FAILED.create();
             } else {
+                ShreddedPaper.ensureSync(level, new BlockPos(box.minX(), box.minY(), box.minZ()), () -> { // ShreddedPaper - run on correct region thread
                 int i2 = 0;
 
                 for (BlockPos blockPos : BlockPos.betweenClosed(box.minX(), box.minY(), box.minZ(), box.maxX(), box.maxY(), box.maxZ())) {
@@ -223,13 +_,24 @@
                     level.updateNeighboursOnBlockSet(updatedPosition.pos, updatedPosition.oldState);
                 }
 
+                // ShreddedPaper start - clear cached chunk packets for affected chunks
+                for (int chunkX = box.minX() >> 4; chunkX <= box.maxX() >> 4; chunkX++) {
+                    for (int chunkZ = box.minZ() >> 4; chunkZ <= box.maxZ() >> 4; chunkZ++) {
+                        net.minecraft.world.level.chunk.LevelChunk chunk = level.getChunkIfLoaded(chunkX, chunkZ);
+                        if (chunk != null) chunk.cachedChunkPacket = null;
+                    }
+                }
+                // ShreddedPaper end - clear cached chunk packets for affected chunks
+
                 if (i2 == 0) {
-                    throw ERROR_FAILED.create();
+                    source.sendFailure(Component.translatable("commands.fill.failed")); // ShreddedPaper - run on correct region thread - send failure message instead of throwing
                 } else {
                     int i3 = i2;
                     source.sendSuccess(() -> Component.translatable("commands.fill.success", i3), true);
-                    return i2;
+                    // return i2; // ShreddedPaper - run on correct region thread
                 }
+                }); // ShreddedPaper - run on correct region thread
+                return 1; // ShreddedPaper - run on correct region thread
             }
         }
     }
